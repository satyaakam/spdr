// Generated by CoffeeScript 1.6.2
var Downloader, Uploader;

Downloader = (function() {
  function Downloader(url, on_update, on_finish) {
    var start_time, xhr;

    start_time = (new Date()).getTime();
    xhr = new XMLHttpRequest;
    xhr.open('GET', url + "?randomize=" + new Date(), true);
    xhr.overrideMimeType('text/plain; charset=x-user-defined');
    xhr.onreadystatechange = function() {
      var snow, tnow;

      snow = xhr.responseText ? xhr.responseText.length : 0;
      tnow = (new Date()).getTime();
      switch (xhr.readyState) {
        case 0:
          break;
        case 1:
          break;
        case 2:
          break;
        case 3:
          return on_update(tnow - start_time, snow);
        case 4:
          return on_finish(tnow - start_time, snow);
      }
    };
    xhr.send();
  }

  return Downloader;

})();

Uploader = (function() {
  function Uploader(url, size, on_update, on_finish) {
    var fd, start_time, str, xhr;

    start_time = (new Date()).getTime();
    xhr = new XMLHttpRequest;
    xhr.open('POST', url, true);
    xhr.overrideMimeType('text/plain; charset=x-user-defined');
    xhr.onreadystatechange = function(evt) {
      var snow, tnow;

      snow = size;
      tnow = (new Date()).getTime();
      switch (xhr.readyState) {
        case 0:
          break;
        case 1:
          break;
        case 2:
          break;
        case 3:
          return on_update(tnow - start_time, snow);
        case 4:
          return on_finish(tnow - start_time, snow);
      }
    };
    str = "";
    while (str.length < size) {
      str += Math.random().toString(36).substr(2);
    }
    str.substr(0, size);
    fd = new FormData();
    fd.append('data', str);
    xhr.send(fd);
  }

  return Uploader;

})();
